(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{63:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return i})),n.d(t,"default",(function(){return l}));var r=n(2),a=n(6),o=(n(0),n(90)),c={title:"Automation Tests"},s={unversionedId:"backend/mocha",id:"backend/mocha",isDocsHomePage:!1,title:"Automation Tests",description:"4.1 Objective",source:"@site/docs\\backend\\mocha.md",permalink:"/cmmp-docs/backend/mocha",editUrl:"https://github.com/drosu/creative_mixed-use_matching_platform/edit/master/docs/docs/backend/mocha.md",sidebar:"someSidebar",previous:{title:"APIs",permalink:"/cmmp-docs/backend/apis"},next:{title:"GraphDB Utils",permalink:"/cmmp-docs/backend/graphdb-utils"}},i=[{value:"4.1 Objective",id:"41-objective",children:[]},{value:"4.3 Test format",id:"43-test-format",children:[]},{value:"4.4 End-to-End Test",id:"44-end-to-end-test",children:[]},{value:"4.5 Integration Test",id:"45-integration-test",children:[]}],p={rightToc:i};function l(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h3",{id:"41-objective"},"4.1 Objective"),Object(o.b)("p",null,"The goal of running the test is to prevent potential errors before the code ships. ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://mochajs.org/"}),"Mocha")," is an automation tool from JS "),Object(o.b)("h4",{id:"41-setup"},"4.1 Setup"),Object(o.b)("p",null,"In configuration file ",Object(o.b)("inlineCode",{parentName:"p"},"config/grapgDB.js"),", load different config file ",Object(o.b)("inlineCode",{parentName:"p"},"configTest")," for graphDB. Also, we use different\nrepository ",Object(o.b)("inlineCode",{parentName:"p"},"cmmpTest")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),"async function createRepository() {\n  const form = new FormData();\n  if (process.env.test)\n    form.append('config', fs.createReadStream(__dirname + '/configTest.ttl'));\n  else\n    form.append('config', fs.createReadStream(__dirname + '/config.ttl'));\n  form.append('location', '');\n  const res = await fetch(graphdb.addr + '/rest/repositories', {\n    method: 'POST',\n    body: form,\n    headers: form.getHeaders()\n  });\n  if (res.status === 500) {\n    throw Error('Fails to create repository: ' + (await res.json()).message);\n  }\n}\n")),Object(o.b)("p",null,"For configuration in ",Object(o.b)("inlineCode",{parentName:"p"},"server/config/index.js"),", we user different route ",Object(o.b)("inlineCode",{parentName:"p"},"/cmmpTest")," instead"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),"mongodb: {\n    addr: `mongodb://${isDocker ? 'host.docker.internal' : 'localhost'}:27017/cmmp`     addr: `mongodb://${isDocker ? 'host.docker.internal' : 'localhost'}:27017/${process.env.test ? \"cmmpTest\" : \"cmmp\"}`\n  }\n")),Object(o.b)("h4",{id:"42-test-file-configuration"},"4.2 Test file configuration"),Object(o.b)("p",null,"To set up the test environment, we import the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.npmjs.com/package/chai"}),"chai")," npm packages\nand ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/cmmp-docs/backend/express#222-set-and-import-server-configuration"}),"configuration")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),"process.env.test = 'true';\nconst app = require('../loaders/express');\nconst chai = require(\"chai\");\nconst chaiHttp = require(\"chai-http\");\nconst {expect} = chai;\nchai.use(chaiHttp);\nconst config = require('../config');\n")),Object(o.b)("p",null,"Also, start the server beforehand, we need to make sure that graphDB and mongoDB reset before testing."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),"before('Start server', async function () {\n  this.timeout(20 * 1000);\n\n  // Speedup hashing in test.\n  config.passwordHashing.iterations = config.passwordHashing.iterations / 100;\n\n  await require('../loaders/graphDB').load();\n  const {db} = require(\"../loaders/mongoDB\");\n\n  // Remove all data from MongoDB\n  await db.dropDatabase();\n\n  console.log('Server Started!')\n});\n\n")),Object(o.b)("h3",{id:"43-test-format"},"4.3 Test format"),Object(o.b)("p",null,"Format of the test"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),'const chai = require("chai");\nconst {expect} = chai;\ndescribe("test example", function () {\n  it("test example 1" , async () => {\n    ...\n  })\n})\n')),Object(o.b)("p",null,"In ",Object(o.b)("inlineCode",{parentName:"p"},"it")," The following is to check whether the result is expected"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),'it("get the result", async () => {\n    ...\n    expect(resVar).eq(var)\n    expect(res).to.have.status(200);\n})\n')),Object(o.b)("h3",{id:"44-end-to-end-test"},"4.4 End-to-End Test"),Object(o.b)("p",null,"Test whether the api cause error or not"),Object(o.b)("p",null,"The following is an example"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),'describe("Server!", () => {\n  const agent = chai.request.agent(app);\n\n  it("welcomes user to the api", async () => {\n    const res = await agent.get("/");\n    expect(res).to.have.status(200);\n  });\n});\n')),Object(o.b)("h3",{id:"45-integration-test"},"4.5 Integration Test"),Object(o.b)("p",null,"Test the functionalities and correctness"),Object(o.b)("p",null,"The following is an example"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),'it("Validates Users", async () => {\n    for (let i = 0; i < tokens.length; i++) {\n      await User.verify_token(tokens[i])\n    }\n\n    const numberOfUsersInMongoDB = (await MongoDBUserModel.find({})).length\n    const numberOfUsersInGraphDB = (await User.all()).length\n\n    // After the validation, it will saves the user to GraphDB\n    expect(numberOfUsersInMongoDB).eq(numberOfUsersBeforeInMongoDB + numberOfUsers)\n    expect(numberOfUsersInGraphDB).eq(numberOfUsersBeforeInGraphDB + numberOfUsers)\n  })\n')))}l.isMDXComponent=!0},90:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.a.createContext({}),l=function(e){var t=a.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},b=function(e){var t=l(e.components);return a.a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),b=l(n),d=r,m=b["".concat(c,".").concat(d)]||b[d]||u[d]||o;return n?a.a.createElement(m,s(s({ref:t},p),{},{components:n})):a.a.createElement(m,s({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,c=new Array(o);c[0]=d;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:r,c[1]=s;for(var p=2;p<o;p++)c[p]=n[p];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);
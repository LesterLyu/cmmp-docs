(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{78:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return i})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return p}));var n=a(2),o=a(6),r=(a(0),a(89)),c={id:"docker",title:"Docker"},i={unversionedId:"docker/docker",id:"docker/docker",isDocsHomePage:!1,title:"Docker",description:"Docker Best Practices",source:"@site/docs\\docker\\docker.md",permalink:"/cmmp-docs/docker/docker",editUrl:"https://github.com/drosu/creative_mixed-use_matching_platform/edit/master/docs/docs/docker/docker.md",sidebar:"someSidebar",previous:{title:"Deployment",permalink:"/cmmp-docs/general/deployment"},next:{title:"GraphDB",permalink:"/cmmp-docs/docker/graphdb"}},s=[{value:"Docker Best Practices",id:"docker-best-practices",children:[{value:"Keep the image small",id:"keep-the-image-small",children:[]},{value:"Don\u2019t install unnecessary packages",id:"dont-install-unnecessary-packages",children:[]},{value:"Decouple the application",id:"decouple-the-application",children:[]},{value:"How to persist application data?",id:"how-to-persist-application-data",children:[]},{value:"How to access a folder from the host? why?",id:"how-to-access-a-folder-from-the-host-why",children:[]},{value:"Logging",id:"logging",children:[]}]}],l={rightToc:s};function p(e){var t=e.components,a=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"docker-best-practices"},"Docker Best Practices"),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Also take a look of the ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.docker.com/develop/dev-best-practices/"}),"Best practice for docker development"),"\n& ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/"}),"Best practice for writing Dockerfiles")))),Object(r.b)("h3",{id:"keep-the-image-small"},"Keep the image small"),Object(r.b)("p",null,"Start with an appropriate base image. For example, we want a node.js environment, we can search nodejs images. There\nare a few ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://hub.docker.com/_/node/?tab=description"}),"image variants for nodejs"),":"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"node:14")," ~345MB"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"node:14-stretch")," ~345MB"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"node:14-buster")," ~322MB"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"node:14-slim")," ~57MB"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"node:14-alpine")," ~28MB")),Object(r.b)("p",null,"As you see, each variant come with different image size. Personally I prefer the ",Object(r.b)("inlineCode",{parentName:"p"},"slim")," version for Node.js, as\n",Object(r.b)("inlineCode",{parentName:"p"},"alpine")," images may have some compatibility issue with some packages that is designed for Ubuntu/Debian."),Object(r.b)("h3",{id:"dont-install-unnecessary-packages"},"Don\u2019t install unnecessary packages"),Object(r.b)("p",null,"To reduce complexity, dependencies, file sizes, and build times, avoid installing extra or\nunnecessary packages just because they might be \u201cnice to have.\u201d For example,\nyou don\u2019t need to include a text editor in a database container."),Object(r.b)("h3",{id:"decouple-the-application"},"Decouple the application"),Object(r.b)("p",null,"Each container should have only one concern. Decoupling applications into multiple containers makes\nit easier to scale horizontally and reuse containers. For example, a web application should have\ndatabase and server as two separate containers."),Object(r.b)("h3",{id:"how-to-persist-application-data"},"How to persist application data?"),Object(r.b)("p",null,"In the case that the docker image updates, the whole container recreates and does not persist the\ninternal data. If we want to keep the data of the container, docker volumes requires to persist the data\nfor you application. "),Object(r.b)("p",null,"For example, MongoDB's default data storage path is ",Object(r.b)("inlineCode",{parentName:"p"},"/data/db"),", so we want to mount a dedicated volume\nto ",Object(r.b)("inlineCode",{parentName:"p"},"/data/db"),". We should modify ",Object(r.b)("inlineCode",{parentName:"p"},"docker-compose.yaml"),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),'version: "3.8"\nservices:\nmongodb:\n  volumes:\n    - mongodb_data:/data/db\nvolumes:\n  mongodb_data:\n')),Object(r.b)("h3",{id:"how-to-access-a-folder-from-the-host-why"},"How to access a folder from the host? why?"),Object(r.b)("p",null,"A docker container is just a dedicated environment for a specific application. For development,\nwe usually keep the application code in our host system instead of a docker container, and we mount\nthat folder that contains the application code to the docker container."),Object(r.b)("p",null,"For example, the server code resides in ",Object(r.b)("inlineCode",{parentName:"p"},"./server"),", we mount ",Object(r.b)("inlineCode",{parentName:"p"},"./server")," from the host to\n",Object(r.b)("inlineCode",{parentName:"p"},"/root/server")," in the docker container:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),'version: "3.8"\nservices:\n  server:\n    volumes:\n      - ./server:/root/server\n')),Object(r.b)("p",null,"If the server supports auto-reload, which is yes in our case, changes made on the host will trigger\nan auto-reload in the docker container."),Object(r.b)("h3",{id:"logging"},"Logging"),Object(r.b)("p",null,"You can configure the logging driver, address, size, number of files"),Object(r.b)("div",{className:"admonition admonition-important alert alert--info"},Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Please see the official documentation ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.docker.com/compose/compose-file/#logging"}),"https://docs.docker.com/compose/compose-file/#logging")))))}p.isMDXComponent=!0},89:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return u}));var n=a(0),o=a.n(n);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=o.a.createContext({}),p=function(e){var t=o.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=p(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=p(a),m=n,u=d["".concat(c,".").concat(m)]||d[m]||b[m]||r;return a?o.a.createElement(u,i(i({ref:t},l),{},{components:a})):o.a.createElement(u,i({ref:t},l))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,c=new Array(r);c[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:n,c[1]=i;for(var l=2;l<r;l++)c[l]=a[l];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);